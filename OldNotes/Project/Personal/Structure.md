# Open API Specification (SWAGGER)
### Create Entitys and the structure of the APIs specified in the .yml file
### To in sert into \resources\openapi
#### Configuration
```yml
openapi: 3.0.0
info:
  title: SWAGGER Example
  version: 1.0.0
```
#### Define the APIs
```yml
paths:

  /expense:
    get:
      summary: Expenses List
      operationId: getExpensesList
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetrieveExpensesResponse'
        '404':
          description: No expenses found
```
#### Define the Entities
```yml
components:
  schemas:
    RetrieveExpensesResponse:
      type: object
      properties:
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/ExpenseDTO'

    ExpenseDTO:
      type: object
      description: Data element for Expense
      required:
        - email
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        amount:
          type: number
        date:
          type: string
          format: date
        category:
          type: string
```

# POM
## Dependencies
```xml
		<dependency>
			<groupId>org.openapitools</groupId>
			<artifactId>jackson-databind-nullable</artifactId>
			<version>0.2.4</version>
		</dependency>

		<dependency>
			<groupId>io.swagger</groupId>
			<artifactId>swagger-annotations</artifactId>
			<version>1.6.8</version>
		</dependency>

		<!-- https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-starter-webmvc-ui -->
		<dependency>
			<groupId>org.springdoc</groupId>
			<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
			<version>2.2.0</version>
		</dependency>


		<!-- https://mvnrepository.com/artifact/javax.validation/validation-api -->
		<dependency>
			<groupId>javax.validation</groupId>
			<artifactId>validation-api</artifactId>
			<version>2.0.1.Final</version>
		</dependency>

		<!-- https://mvnrepository.com/artifact/javax.annotation/javax.annotation-api -->
		<dependency>
			<groupId>javax.annotation</groupId>
			<artifactId>javax.annotation-api</artifactId>
			<version>1.3.2</version>
		</dependency>

		<!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api -->
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>javax.servlet-api</artifactId>
			<version>4.0.1</version>
		</dependency>
```
## Plugin
### Need to declare in the pom plugin the settings for the code generation
### - apiPackage: The package where the APIs will be generated
### - modelPackage: The package where the Entities will be generated
### They must be in same package of the springboot application class
```xml
			<plugin>
				<groupId>org.openapitools</groupId>
				<artifactId>openapi-generator-maven-plugin</artifactId>
				<version>5.4.0</version>
				<executions>
					<execution>
						<goals>
							<goal>generate</goal>
						</goals>
						<configuration>
							<inputSpec>
								${project.basedir}/src/main/resources/openapi/Expenses.yml
							</inputSpec>
							<generatorName>spring</generatorName> <!-- set the generation type-->
							<!--							backend/Expenses/target/classes/com/projectalt96/Expenses/gen-->
							<apiPackage>com.projectalt96.core.api</apiPackage>
							<modelPackage>com.projectalt96.core.dto</modelPackage>
							<supportingFilesToGenerate>
								ApiUtil.java
							</supportingFilesToGenerate>
							<configOptions>
								<delegatePattern>true</delegatePattern>
								<serializableModel>true</serializableModel>
							</configOptions>
						</configuration>
					</execution>
				</executions>
			</plugin>
```

# Create and expose the APIs
## Delegation implementation
### The implementation of the APIs is delegated to the class ExpensesApiDelegateImpl
### - ExpenseApiDelegate is auto generated by openapi
### - The response is declared in the autogenerated class RetrieveExpensesResponse
```java
@Service
public class ExpenseDelegateImpl implements ExpenseApiDelegate {
    @Autowired
    private final ExpensesService expensesService;
    @Autowired
    ExpensesMapper expensesMapper;

    public ExpenseDelegateImpl(ExpensesService expensesService) {
        this.expensesService = expensesService;
    }

    @Override
//    http://localhost:8090/expense GET
    public ResponseEntity<RetrieveExpensesResponse> getExpensesList() {
        RetrieveExpensesResponse responseEntity = new RetrieveExpensesResponse();
        List<ExpenseJpa> expenseJpaList = expensesService.getExpensesList();
        List<ExpenseDTO> expenseDTOList = new ArrayList<>();
        expenseJpaList.forEach(expenseJpa -> {
            expenseDTOList.add(expensesMapper.expenseJpaEntityToExpense(expenseJpa));
        });
        responseEntity.setExpenses(expenseDTOList);
        return ResponseEntity.ok(responseEntity);
    }
}
```
## Service
### Retrive the data from the database
```java
@Service
public class ExpensesService {
    @Autowired
    ExpensesJpaRepository expensesJpaRepository;
    @Autowired
    ExpensesMapper expensesMapper;

    public List<ExpenseJpa> getExpensesList(){
        List<ExpenseJpa> expenseJpaList = expensesJpaRepository.findAll();
        return expenseJpaList;
    }
    
}
```
## Repository
```java
public interface ExpensesJpaRepository extends JpaRepository<ExpenseJpa,String> {
}
```
### To add new methods to the repository
### - Spring Data JPA will auto implement the method based on the name of the method
```java
public interface ExpensesJpaRepository extends JpaRepository<ExpenseJpa,String> {
    List<ExpenseJpa> findByCategory(String category);
}
```
## Mapper
### Map the JpaEntity into DTO
```java
@Component
public class ExpensesMapper {

    public ExpenseDTO expenseJpaEntityToExpense(ExpenseJpa expenseEntity) {
        ExpenseDTO expense = new ExpenseDTO();
        expense.setId(expenseEntity.getId());
        expense.setName(expenseEntity.getName());
        expense.setDescription(expenseEntity.getDescription());
        expense.setAmount(expenseEntity.getAmount());
        expense.setDate(expenseEntity.getDate());
        expense.setCategory(expenseEntity.getCategory());
        return expense;
    }
}
```
## JpaEntity
### The JpaEntity is the representation of the table in the database 
### the pojo is auto generated by openapi so they are separated in two classes
```java
@Entity
@Table(name = "expense")
public class ExpenseJpa implements Serializable {
    @Id
    private String id;
    private String name;
    private String description;
    private BigDecimal amount;
    private LocalDate date;
    private String category;
    //getters and setters
}
```